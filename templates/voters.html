{% extends "base.html" %}
{% block content %}
<div class="row-gap mt-2">
  <a class="btn" href="{{ url_for('add_voter') }}">‚ûï Add Voter</a>
  <a class="btn" href="{{ url_for('download_excel') }}">‚¨áÔ∏è Excel</a>
  <a class="btn" href="{{ url_for('download_csv') }}">‚¨áÔ∏è CSV</a>
  <form method="post" action="{{ url_for('reset_votes') }}" class="inline-reset" onsubmit="return confirm('Reset all votes?');">
    <div class="row-gap">
      <button type="button" class="btn danger" id="resetRevealBtn" onclick="showResetPassword()">üîÑ Reset Votes</button>
      <div id="resetPwdWrap" class="hidden">
        <input class="input small" type="password" name="admin_password" id="resetPwd" placeholder="Admin password">
        <button class="btn danger" type="submit">Confirm Reset</button>
        <button class="btn subtle" type="button" onclick="hideResetPassword()">Cancel</button>
      </div>
    </div>
  </form>
</div>

<div class="table-wrap mt-2">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Fingerprint</th>
        <th>Voted</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for v in voters %}
      <tr>
        <td>{{ v['id'] }}</td>
        <td>{{ v['name'] }}</td>
        <td class="mono">{{ v['fingerprint_template'] }}</td>
        <td>{% if v['has_voted'] %}<span class="badge yes">Yes</span>{% else %}<span class="badge no">No</span>{% endif %}</td>
        <td>
          <form method="post" action="{{ url_for('delete_voter', voter_id=v['id']) }}" class="inline-delete" onsubmit="return confirm('Delete voter #{{ v['id'] }}?');">
            <div id="del-wrap-{{ v['id'] }}">
              <button type="button" class="btn danger" onclick="revealDeletePwd({{ v['id'] }})">üóë Delete</button>
            </div>
            <div id="del-confirm-{{ v['id'] }}" class="hidden">
              <input class="input small" type="password" name="admin_password" placeholder="Admin password" required>
              <button class="btn danger" type="submit">Confirm</button>
              <button class="btn subtle" type="button" onclick="cancelDelete({{ v['id'] }})">Cancel</button>
            </div>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>

<script>
function showResetPassword() {
  document.getElementById('resetRevealBtn').classList.add('hidden');
  document.getElementById('resetPwdWrap').classList.remove('hidden');
  document.getElementById('resetPwd').focus();
}
function hideResetPassword() {
  document.getElementById('resetPwdWrap').classList.add('hidden');
  document.getElementById('resetRevealBtn').classList.remove('hidden');
}
function revealDeletePwd(id) {
  document.getElementById('del-wrap-' + id).classList.add('hidden');
  document.getElementById('del-confirm-' + id).classList.remove('hidden');
}
function cancelDelete(id) {
  document.getElementById('del-confirm-' + id).classList.add('hidden');
  document.getElementById('del-wrap-' + id).classList.remove('hidden');
}
</script>
{% endblock %}
